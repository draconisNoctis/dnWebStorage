{"version":3,"sources":["../src/dnWebStorage.ts"],"names":["dnWebStorage","dnWebStorage.STORAGE_TYPE","dnWebStorage.STORAGE_MAP","dnWebStorage.StorageProto","dnWebStorage.StorageProto.constructor","dnWebStorage.StorageProto.$defaults","dnWebStorage.StorageProto.$reset","dnWebStorage.StorageProvider","dnWebStorage.StorageProvider.constructor","dnWebStorage.storageStoreFactory","dnWebStorage.storageStoreFactory.get","dnWebStorage.storageStoreFactory.put","dnWebStorage.storageStoreFactory.remove","dnWebStorage.LocalStorageProvider","dnWebStorage.LocalStorageProvider.constructor","dnWebStorage.SessionStorageProvider","dnWebStorage.SessionStorageProvider.constructor"],"mappings":"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","file":"dnWebStorage.js","sourceRoot":"","sourcesContent":["/* istanbul ignore next: ts __extends */\n/// <reference path=\"../typings/angularjs/angular.d.ts\" />\n\nmodule dnWebStorage {\n\n\texport enum STORAGE_TYPE {\n\t\tLOCAL,\n\t\tSESSION\n\t}\n\n\tenum STORAGE_MAP {\n\t\tlocalStorage,\n\t\tsessionStorage\n\t}\n\n\texport interface IStorage {\n\t\t$defaults(items : { [key : string] : string }) : IStorage;\n\t\t$reset(items : { [key : string] : string }) : IStorage;\n\t\t[key : string] : any;\n\t}\n\n\texport interface IStore {\n\t\tput(key : string, value : any) : void;\n\t\tget(key : string) : any;\n\t\tremove(key : string) : void;\n\t}\n\n\t/* istanbul ignore next */\n\tclass StorageProto {\n\t\t$defaults(items : { [key : string] : string }) {\n\t\t\tfor(var key in items) {\n\t\t\t\tundefined === this[key] && (this[key] = items[key]);\n\t\t\t}\n\n\t\t\treturn this;\n\t\t}\n\t\t$reset(items? : { [key : string] : string }) {\n\t\t\tfor(var key in this) {\n\t\t\t\t'$' === key[0] || delete this[key];\n\t\t\t}\n\n\t\t\tif(items) {\n\t\t\t\tthis.$defaults(items);\n\t\t\t}\n\n\t\t\treturn this;\n\t\t}\n\t}\n\t\n\t['$defaults', '$reset'].forEach((prop) => {\n\t\tvar d = Object.getOwnPropertyDescriptor(StorageProto.prototype, prop);\n\t\td.enumerable = false;\n\t\tObject.defineProperty(StorageProto.prototype, prop, d);\n\t});\n\n\texport /*abstract*/ class StorageProvider {\n\t\tprivate _prefix : string = 'ngWebStorage-';\n\t\tpublic/*protected*/ type : STORAGE_TYPE;\n\n\t\tset prefix(prefix : string) {\n\t\t\tthis._prefix = prefix;\n\t\t}\n\n\t\tget prefix() : string {\n\t\t\treturn this._prefix\n\t\t}\n\n\n\t\t$get = ['$window', '$rootScope', ($window : ng.IWindowService, $rootScope : ng.IScope) => {\n\t\t\tvar webStorage = $window[STORAGE_MAP[this.type]],\n\t\t\t\t$storage : IStorage = Object.create(StorageProto.prototype);\n\t\t\t/* istanbul ignore next */\n\t\t\tif(!webStorage) {\n\t\t\t\tthrow new Error('Browser doesn\\\\t support web storage \"' + STORAGE_MAP[this.type] + '\"');\n\t\t\t}\n\n\t\t\tfor(var index = -1, length = webStorage.length, key : string; ++index < length;) {\n\t\t\t\tkey = webStorage.key(index);\n\t\t\t\tif(this._prefix === key.substr(0, this._prefix.length)) {\n\t\t\t\t\t$storage[key.substr(this._prefix.length)] = angular.fromJson(webStorage.getItem(key));\n\t\t\t\t}\n\t\t\t}\n\n\n\n\t\t\tvar _update = (newValue, oldValue) => {\n\t\t\t\tvar key : string;\n\t\t\t\tfor(key in newValue) {\n\t\t\t\t\tif(undefined !== newValue[key] && '$' !== key[0]) {\n\t\t\t\t\t\twebStorage.setItem(this._prefix + key, angular.toJson(newValue[key]));\n\t\t\t\t\t}\n\t\t\t\t\tdelete oldValue[key];\n\t\t\t\t}\n\t\t\t\tfor(key in oldValue) {\n\t\t\t\t\twebStorage.removeItem(this._prefix + key);\n\t\t\t\t}\n\t\t\t}, \n\t\t\t_check = () => {\n\t\t\t\tif(!angular.equals($storage, _saved$storage)) {\n\t\t\t\t\t_update($storage, _saved$storage);\n\t\t\t\t\t_saved$storage = angular.copy($storage);\n\t\t\t\t}\n\t\t\t\t_timeout = undefined;\n\t\t\t}, _saved$storage = angular.copy($storage), _timeout;\n\n\n\t\t\t$rootScope.$watch(() => {\n\t\t\t\t_timeout || (_timeout = window.setTimeout(_check, 100));\n\t\t\t});\n\n\t\t\tif(STORAGE_TYPE.LOCAL === this.type) {\n\t\t\t\t/* istanbul ignore next */\n\t\t\t\t$window.addEventListener('storage', (event) => {\n\t\t\t\t\tif(this._prefix === event.key.substr(0, this._prefix.length)) {\n\t\t\t\t\t\tif(event.newValue) {\n\t\t\t\t\t\t\t$storage[event.key.substr(this._prefix.length)] = angular.fromJson(event.newValue);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdelete $storage[event.key.substr(this._prefix.length)];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, false);\n\t\t\t}\n\n\t\t\treturn $storage;\n\t\t}]\n\t}\n\n\tfunction storageStoreFactory(type : STORAGE_TYPE) {\n\t\treturn ['dn' + STORAGE_MAP[type].charAt(0).toUpperCase() + STORAGE_MAP[type].substr(1), ($storage : IStorage) => {\n\t\t\treturn {\n\t\t\t\tget(key : string) : any {\n\t\t\t\t\treturn $storage[key];\n\t\t\t\t},\n\t\t\t\tput(key : string, value : any) {\n\t\t\t\t\t$storage[key] = value;\n\t\t\t\t},\n\t\t\t\tremove(key : string) {\n\t\t\t\t\tdelete $storage[key];\n\t\t\t\t}\n\t\t\t}\n\t\t}]\n\t}\n\n\texport class LocalStorageProvider extends StorageProvider {\n\t\tpublic type : STORAGE_TYPE = STORAGE_TYPE.LOCAL;\n\n\t\tconstructor() {\n\t\t\tsuper();\n\t\t}\n\t}\n\n\texport class SessionStorageProvider extends StorageProvider {\n\t\tpublic type : STORAGE_TYPE = STORAGE_TYPE.SESSION;\n\n\t\tconstructor() {\n\t\t\tsuper();\n\t\t}\n\t}\n\n\tangular.module('dnWebStorage', ['ng'])\n\t\t.provider('dnSessionStorage', SessionStorageProvider)\n\t\t.provider('dnLocalStorage', LocalStorageProvider)\n\t\t.factory('dnSessionStorageStore', storageStoreFactory(STORAGE_TYPE.SESSION))\n\t\t.factory('dnLocalStorageStore', storageStoreFactory(STORAGE_TYPE.LOCAL))\n\t\n}"]}